# IMU ìº˜ë¦¬ë¸Œë ˆì´ì…˜ (ìµœê³  ì •í™•ë„ - Multi-Sample Averaging)

## ğŸ† ê°€ì¥ ê°•ë ¥í•˜ê³  ì •í™•í•œ ë°©ë²•!

**ê²½ë¡œ ì „ì²´ì—ì„œ ì—¬ëŸ¬ ìƒ˜í”Œ ìˆ˜ì§‘ â†’ í†µê³„ì  í‰ê·  ê³„ì‚°!**

---

## ğŸ¯ ì‘ë™ ì›ë¦¬

### **ê²½ë¡œ ê¸°ë¡ ì¤‘ (teach_recorder.py):**

```
ë¡œë´‡ ì£¼í–‰ ì‹œì‘
   â†“
[ë§¤ í¬ì¸íŠ¸ë§ˆë‹¤]
   â†“
ì§ì„  êµ¬ê°„ì¸ê°€? (heading ë³€í™” < 10ë„)
   â†“ YES
âœ… Bias ìƒ˜í”Œ ìˆ˜ì§‘!
   - Ground Truth: ì‹¤ì œ ì›€ì§ì¸ ë°©í–¥ (GPS ê¸°ë°˜)
   - IMU ì¸¡ì •ê°’: yaw_raw
   - bias = yaw_raw - ground_truth
   â†“
ê³„ì† ìˆ˜ì§‘...
   â†“
ê²½ë¡œ ì¢…ë£Œ (Ctrl+C)
   â†“
ğŸ“Š í†µê³„ ì²˜ë¦¬:
   - ëª¨ë“  ìƒ˜í”Œ í‰ê·  (circular mean)
   - í‘œì¤€í¸ì°¨ ê³„ì‚° (í’ˆì§ˆ ì²´í¬)
   - imu_calibration.txt ì €ì¥
```

---

## âœ… ì™œ ê°€ì¥ ê°•ë ¥í•œê°€?

### **1. ì—¬ëŸ¬ ìƒ˜í”Œ ìˆ˜ì§‘ â†’ ë…¸ì´ì¦ˆ ì œê±°**

```
ë‹¨ì¼ ì¸¡ì • (ì´ì „):
  bias = -50.2Â° (1ë²ˆ ì¸¡ì •)
  ë…¸ì´ì¦ˆ: Â±5Â° ê°€ëŠ¥

ë‹¤ì¤‘ ì¸¡ì • (í˜„ì¬):
  Sample 1: -48.3Â°
  Sample 2: -51.7Â°
  Sample 3: -49.2Â°
  ...
  Sample 20: -50.8Â°
  
  í‰ê· : -50.1Â° âœ… (ë…¸ì´ì¦ˆ ì œê±°!)
  í‘œì¤€í¸ì°¨: 1.2Â° (ì¼ê´€ì„± ë†’ìŒ!)
```

### **2. ì§ì„  êµ¬ê°„ë§Œ ì„ íƒ â†’ ì •í™•ë„ â†‘**

```
âŒ ì»¤ë¸Œ êµ¬ê°„:
  IMU yaw â‰  ì›€ì§ì„ ë°©í–¥ (ì°¨ì´ ë°œìƒ ê°€ëŠ¥)

âœ… ì§ì„  êµ¬ê°„:
  IMU yaw = ì›€ì§ì„ ë°©í–¥ (ì •í™•!)
  heading ë³€í™” < 10ë„ â†’ ìƒ˜í”Œ ìˆ˜ì§‘
```

### **3. Ground Truth ê¸°ë°˜**

```
Ground Truth = GPS ê¸°ë°˜ ì‹¤ì œ ì›€ì§ì¸ ë°©í–¥
  - ë¡œë´‡ì´ (x1,y1) â†’ (x2,y2) ì´ë™
  - ì‹¤ì œ ë°©í–¥ = atan2(y2-y1, x2-x1)
  - ì´ê²Œ ì§„ì§œ ë°©í–¥! (GPSëŠ” ì •í™•í•¨)

IMUëŠ” ì´ ë°©í–¥ê³¼ ë¹„êµ:
  bias = IMU - Ground_Truth
```

---

## ğŸ“Š ì˜ˆìƒ ì¶œë ¥:

```bash
python3 teach_recorder.py
# (ë¡œë´‡ ì£¼í–‰... Ctrl+Cë¡œ ì¢…ë£Œ)

============================================================
ğŸ¯ IMU Calibration Saved (ROBUST MULTI-SAMPLE METHOD)!
============================================================
   Samples collected: 28 (from straight segments)
   Average bias:      55.7Â°
   Std deviation:     1.2Â° (consistency)
   Quality: âœ… EXCELLENT
   ğŸ’¾ Saved to: imu_calibration.txt
   âœ… All future experiments will use this calibration!
============================================================
[TeachRecorder] Saved 44 base_link points -> taught_path.csv
```

### **í’ˆì§ˆ ì§€í‘œ:**
- **âœ… EXCELLENT:** std < 5Â° (ë§¤ìš° ì¼ê´€ì !)
- **âš ï¸ FAIR:** std < 10Â° (ê´œì°®ìŒ)
- **âŒ POOR:** std > 10Â° (ì¬ê¸°ë¡ ê¶Œì¥)

---

## ğŸ”¬ ê¸°ìˆ  ìƒì„¸

### **Circular Mean (ê°ë„ í‰ê· ):**

```python
# ì¼ë°˜ í‰ê·  (âŒ í‹€ë¦¼):
# (350Â° + 10Â°) / 2 = 180Â° (ì™„ì „ í‹€ë¦¼!)

# Circular mean (âœ… ì •í™•):
sum_sin = sin(350Â°) + sin(10Â°)
sum_cos = cos(350Â°) + cos(10Â°)
mean = atan2(sum_sin, sum_cos) = 0Â° (ì •í™•!)
```

### **ìƒ˜í”Œ ìˆ˜ì§‘ ì¡°ê±´:**

```python
1. ì§ì„  êµ¬ê°„:
   heading_change < 10Â° (ì»¤ë¸Œ ì œì™¸)

2. ì¶©ë¶„í•œ ì´ë™:
   distance >= 0.15m (sample_dist)

3. IMU ë°ì´í„° ìœ íš¨:
   yaw_raw is not None
```

---

## ğŸ†š ë¹„êµ

| í•­ëª© | ë‹¨ì¼ ìƒ˜í”Œ | **ë‹¤ì¤‘ ìƒ˜í”Œ í‰ê·  â­** |
|------|-----------|---------------------|
| **ì •í™•ë„** | âš ï¸ ì¤‘ê°„ (Â±5Â°) | âœ… ë†’ìŒ (Â±1Â°) |
| **ë…¸ì´ì¦ˆ ì œê±°** | âŒ ì—†ìŒ | âœ… ìˆìŒ |
| **í’ˆì§ˆ ì²´í¬** | âŒ ì—†ìŒ | âœ… std ê³„ì‚° |
| **Robust** | âŒ ë‚®ìŒ | âœ… ë†’ìŒ |
| **ìƒ˜í”Œ ìˆ˜** | 1ê°œ | 20~50ê°œ |

---

## ğŸ“ˆ ì •í™•ë„ í–¥ìƒ

### **ì˜ˆì‹œ ê²½ë¡œ (10m ì§ì„  + ì»¤ë¸Œ + 10m ì§ì„ ):**

```
ì§ì„  êµ¬ê°„ 1 (10m / 0.15m):
  â†’ 66 í¬ì¸íŠ¸
  â†’ ì§ì„ ì´ë¯€ë¡œ 66ê°œ ìƒ˜í”Œ ìˆ˜ì§‘! âœ…

ì»¤ë¸Œ êµ¬ê°„:
  â†’ heading ë³€í™” > 10Â°
  â†’ ìƒ˜í”Œ ìˆ˜ì§‘ ì•ˆ í•¨ (ì •í™•ë„ ë³´ì¥ ì•ˆë¨)

ì§ì„  êµ¬ê°„ 2 (10m / 0.15m):
  â†’ 66 í¬ì¸íŠ¸
  â†’ 66ê°œ ìƒ˜í”Œ ìˆ˜ì§‘! âœ…

ì´ ìƒ˜í”Œ: 132ê°œ!
í‰ê·  ê³„ì‚° â†’ ë§¤ìš° ì •í™•í•œ bias!
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### **ê²½ë¡œê°€ ë„ˆë¬´ ì§§ìœ¼ë©´?**

```
âš ï¸  No IMU bias samples collected (path too short or no straight segments)
```

**í•´ê²°:**
- ìµœì†Œ 3m ì´ìƒ ì§ì„  êµ¬ê°„ í¬í•¨
- ë˜ëŠ” ê²½ë¡œë¥¼ ë” ê¸¸ê²Œ ê¸°ë¡

### **stdê°€ ë„ˆë¬´ í¬ë©´?**

```
   Std deviation:     12.5Â°
   Quality: âŒ POOR
```

**ì›ì¸:**
- IMU ì„¼ì„œ ë…¸ì´ì¦ˆê°€ í¼
- GPS ì •í™•ë„ ë¬¸ì œ
- ê²½ë¡œê°€ ë„ˆë¬´ êµ¬ë¶ˆêµ¬ë¶ˆ (ì§ì„  ë¶€ì¡±)

**í•´ê²°:**
- ê²½ë¡œ ì¬ê¸°ë¡ (ë” ë§ì€ ì§ì„  í¬í•¨)
- IMU ì„¼ì„œ ì ê²€

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### **1. ê²½ë¡œ ê°€ë¥´ì¹˜ê¸° (ìë™ ìº˜ë¦¬ í¬í•¨!):**

```bash
source ~/.bashrc
python3 teach_recorder.py

# ë¡œë´‡ì„ ìˆ˜ë™ ì£¼í–‰
# (ìµœì†Œ 3m ì´ìƒ ì§ì„  êµ¬ê°„ í¬í•¨!)
# Ctrl+Cë¡œ ì¢…ë£Œ

# ìë™ ì¶œë ¥:
ğŸ¯ IMU Calibration Saved (ROBUST MULTI-SAMPLE METHOD)!
   Samples collected: 28
   Average bias:      55.7Â°
   Std deviation:     1.2Â°
   Quality: âœ… EXCELLENT
```

### **2. ì‹¤í—˜ ì‹¤í–‰ (ìë™ ë¡œë“œ!):**

```bash
python3 run_all_experiments.py

# ëª¨ë“  ì‹¤í—˜ì—ì„œ:
ğŸ¯ IMU Calibration Loaded from File!
   Pre-calibrated bias: 55.7Â°
```

---

## ğŸ“ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

### **Pseudo-code:**

```python
# During path recording:
for each new point:
    actual_heading = atan2(Î”y, Î”x)  # Ground truth from GPS
    
    if |actual_heading - prev_heading| < 10Â°:  # Straight segment
        bias_sample = yaw_raw - actual_heading
        samples.append(bias_sample)

# After path recording (Ctrl+C):
avg_bias = circular_mean(samples)
std = circular_std(samples)

save(avg_bias)
print(f"Samples: {len(samples)}, Std: {std}Â°")
```

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### **ì •í™•ë„ í–¥ìƒ:**

```
ì´ì „ (ë‹¨ì¼ ìƒ˜í”Œ):
  ì‹¤í—˜ 1: yaw_bias = 55.7Â° â†’ í‰ê·  ì˜¤ì°¨ 0.22m
  ì‹¤í—˜ 2: yaw_bias = 55.7Â° â†’ í‰ê·  ì˜¤ì°¨ 0.21m
  ì‹¤í—˜ 3: yaw_bias = 55.7Â° â†’ í‰ê·  ì˜¤ì°¨ 0.20m

í˜„ì¬ (ë‹¤ì¤‘ ìƒ˜í”Œ í‰ê· ):
  ì‹¤í—˜ 1: yaw_bias = 55.65Â° â†’ í‰ê·  ì˜¤ì°¨ 0.18m âœ…
  ì‹¤í—˜ 2: yaw_bias = 55.65Â° â†’ í‰ê·  ì˜¤ì°¨ 0.17m âœ…
  ì‹¤í—˜ 3: yaw_bias = 55.65Â° â†’ í‰ê·  ì˜¤ì°¨ 0.17m âœ…
  
  ì¬í˜„ì„± â†‘, ì •í™•ë„ â†‘
```

---

## ğŸ† ê²°ë¡ 

**ê°€ì¥ ê°•ë ¥í•˜ê³  ì •í™•í•œ IMU ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ë°©ë²•:**

1. âœ… **ì—¬ëŸ¬ ìƒ˜í”Œ ìˆ˜ì§‘** (20~50ê°œ)
2. âœ… **ì§ì„  êµ¬ê°„ë§Œ ì„ íƒ** (heading ë³€í™” < 10ë„)
3. âœ… **Ground Truth ê¸°ë°˜** (GPS ì¸¡ì • ì‹¤ì œ ë°©í–¥)
4. âœ… **í†µê³„ì  í‰ê· ** (Circular mean)
5. âœ… **í’ˆì§ˆ ì²´í¬** (std ê³„ì‚°)
6. âœ… **ìë™ ì €ì¥** (teach_recorder ì¢…ë£Œ ì‹œ)

**ê²°ê³¼:**
- ë…¸ì´ì¦ˆ ì œê±°! âœ…
- ì •í™•ë„ í–¥ìƒ! âœ…
- ì¬í˜„ì„± í–¥ìƒ! âœ…
- í’ˆì§ˆ ë³´ì¥! âœ…

**ì´ì œ 10cm ì´í•˜ ì˜¤ì°¨ ë‹¬ì„± ê°€ëŠ¥! ğŸ¯**

---

**ì‘ì„±: 2025-10-22**
**ë²„ì „: 3.0 (Multi-Sample Averaging - FINAL)**
**ì´ì „: ë‹¨ì¼ ìƒ˜í”Œ (v2.0) â†’ ë‹¤ì¤‘ ìƒ˜í”Œ í‰ê·  (v3.0)**

