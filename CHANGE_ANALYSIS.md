# 🔍 수정 전후 변경사항 분석

## 이전 버전 특성 (PERFECT PATH MATCHING)

### 설정값
```python
# 속도
v_max = 0.08 m/s  (느림)
v_min = 0.06 m/s
lock_speed = 0.05 m/s  (매우 느림)

# 조향
k_th = 0.7  (부드러운 조향)

# Cross-track Gain (매우 강함!)
Sharp curves:  ct_gain = 3.0, lookahead = 0.9m
Medium curves: ct_gain = 2.6, lookahead = 0.9m
Straight:      ct_gain = 2.3, lookahead = 1.1m

# 필터
alpha = 0.65  (빠른 반응)

# 보정 한계
ct_correction = ±0.9 rad/s  (매우 강함)
```

### 결과
- **왼쪽(안쪽)으로 이탈** (+0.5m)
- Gain이 **너무 강해서** 경로 안쪽으로 과도하게 보정

---

## 현재 버전 특성 (ULTRA PRECISION)

### 설정값
```python
# 속도 ⬆️ 증가
v_max = 0.12 m/s  (+50%)
v_min = 0.08 m/s  (+33%)
lock_speed = 0.12 m/s  (+140%)

# 조향 ⬆️ 증가
k_th = 1.2  (+71%)

# Cross-track Gain ⬇️ 감소
Sharp curves:  ct_gain = 2.0 (-33%), lookahead = 0.8m (-11%)
Medium curves: ct_gain = 1.8 (-31%), lookahead = 1.2m (+33%)
Straight:      ct_gain = 1.5 (-35%), lookahead = 1.5m (+36%)

# 필터 ⬇️ 느려짐
alpha = 0.75  (+15% → 더 느린 반응)

# 보정 한계 ⬇️ 감소
ct_correction = ±0.8 rad/s  (-11%)
```

### 결과
- **바깥쪽으로 이탈**
- Gain이 **약해지고** Lookahead가 **길어져서** corner cutting

---

## 🔍 핵심 문제 분석

### 1. 속도 증가 (0.08 → 0.12 m/s, +50%)
```
문제: 속도가 빠르면 제어 정밀도 감소
효과: 빠른 속도로 인해 오버슈트 발생
```

### 2. Cross-track Gain 감소
```
이전: 3.0 / 2.6 / 2.3  (매우 강함)
현재: 2.0 / 1.8 / 1.5  (-33~35%)

문제: Gain이 약해서 경로 이탈을 충분히 보정 못함
```

### 3. Lookahead 증가 (특히 중요!)
```
Medium curves: 0.9m → 1.2m (+33%)
Straight:      1.1m → 1.5m (+36%)

문제: 멀리 보면 corner cutting 유도!
이것이 바깥쪽 이탈의 주 원인!
```

### 4. 필터 반응성 감소
```
이전: alpha = 0.65  (빠른 반응)
현재: alpha = 0.75  (느린 반응)

문제: 느린 반응으로 경로 이탈 대응 지연
```

### 5. k_th 증가 (0.7 → 1.2, +71%)
```
문제: 조향이 너무 민감해져서 오버슈트 가능
```

---

## 📊 문제 메커니즘

### 이전 버전 (왼쪽 이탈)
```
매우 강한 Gain (3.0)
+
짧은 Lookahead (0.9m)
+
빠른 반응 (alpha 0.65)
=
과도한 보정 → 경로 안쪽(왼쪽)으로 이탈 ❌
```

### 현재 버전 (바깥쪽 이탈)
```
약한 Gain (2.0)
+
긴 Lookahead (1.2-1.5m)  ← 주범!
+
느린 반응 (alpha 0.75)
=
보정 부족 + Corner cutting → 바깥쪽 이탈 ❌
```

---

## 🎯 근본 원인

### 주요 원인 (순서대로)

1. **Lookahead 과도 증가** ⭐⭐⭐
   - Medium: 0.9m → 1.2m (+33%)
   - Straight: 1.1m → 1.5m (+36%)
   - **영향**: Corner cutting 유도, 바깥쪽 이탈의 직접 원인

2. **Cross-track Gain 과도 감소** ⭐⭐
   - 3.0/2.6/2.3 → 2.0/1.8/1.5 (-33~35%)
   - **영향**: 경로 이탈 보정력 부족

3. **속도 증가** ⭐⭐
   - 0.08 → 0.12 m/s (+50%)
   - **영향**: 제어 정밀도 감소, 오버슈트

4. **필터 반응성 감소** ⭐
   - alpha 0.65 → 0.75
   - **영향**: 늦은 반응

5. **k_th 과도 증가**
   - 0.7 → 1.2 (+71%)
   - **영향**: 조향 민감도 증가, 불안정

---

## 💡 올바른 접근

### 이전 vs 현재
```
이전 (PERFECT):     [너무 강함] ← 여기서
현재 (ULTRA):                        → [너무 약함]
                         최적점?
```

### 필요한 것
**이전과 현재의 중간값!**

```
Gain:       3.0 vs 2.0  → 중간: 2.3-2.5
Lookahead:  0.9 vs 1.2  → 중간: 1.0-1.1m
Alpha:      0.65 vs 0.75 → 중간: 0.70
속도:       0.08 vs 0.12 → 중간: 0.10 m/s
```

---

## 🎯 결론

### 현재 문제: 바깥쪽 이탈

**주요 원인:**
1. **Lookahead가 너무 김** (1.2-1.5m)
2. **Gain이 너무 약함** (2.0-1.5)
3. 속도가 너무 빠름 (0.12 m/s)

**해결 방향:**
- Lookahead를 **1.0m 전후**로 줄이기
- Gain을 **2.3-2.5** 정도로 올리기
- 속도를 **0.10 m/s**로 적절히 조정
- 필터를 **alpha 0.70** 정도로 중간값

**목표**: 이전 버전과 현재 버전의 **균형잡힌 중간 지점** 찾기!
