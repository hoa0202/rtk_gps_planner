# 📊 3가지 시점 완전 비교

## 🎯 시점별 설정값과 결과

### Phase 1: 이전 (PERFECT PATH MATCHING) - 안쪽 이탈 ⬅️

**설정값:**
```python
# 속도
v_max = 0.08 m/s
v_min = 0.06 m/s
lock_speed = 0.05 m/s

# 조향
k_th = 0.7

# Cross-track Gain (매우 강함!)
Sharp curves (>0.3):   gain = 3.0,  lookahead = 0.9m
Medium curves (>0.15): gain = 2.6,  lookahead = 0.9m
Straight:              gain = 2.3,  lookahead = 1.1m

# 필터
alpha = 0.65  (빠른 반응)

# 보정 한계
ct_correction = ±0.9 rad/s
```

**결과:**
- **왼쪽(안쪽)으로 이탈** (+0.5m)
- 평균 오차: 0.329m
- 최대 오차: 0.586m

**문제:**
- Gain이 **너무 강함** (3.0)
- Lookahead가 **너무 짧음** (0.9m)
- → **과도한 보정**

---

### Phase 2: 현재 (ULTRA PRECISION) - 바깥쪽 이탈 ➡️

**설정값:**
```python
# 속도
v_max = 0.12 m/s  (+50%)
v_min = 0.08 m/s  (+33%)
lock_speed = 0.12 m/s  (+140%)

# 조향
k_th = 1.2  (+71%)

# Cross-track Gain (약함)
Sharp curves (>0.3):   gain = 2.0,  lookahead = 0.8m
Medium curves (>0.15): gain = 1.8,  lookahead = 1.2m
Straight:              gain = 1.5,  lookahead = 1.5m

# 필터
alpha = 0.75  (느린 반응)

# 보정 한계
ct_correction = ±0.8 rad/s
```

**결과:**
- **바깥쪽으로 이탈** (이미지 확인)
- 평균 오차: 0.377m (추정)
- 최대 오차: 0.620m (추정)

**문제:**
- Gain이 **약함** (2.0)
- Lookahead가 **김** (1.2-1.5m)
- → **보정 부족**

---

### Phase 3: 예상 (BALANCED OPTIMAL) - 정확한 추종 ✅

**예상 설정값:**
```python
# 속도
v_max = 0.10-0.12 m/s  (현재 유지 or 약간 감소)
v_min = 0.08 m/s
lock_speed = 0.10 m/s

# 조향
k_th = 0.9-1.0  (중간값)

# Cross-track Gain (적절함)
Sharp curves (>0.3):   gain = 2.5,  lookahead = 1.0m
Medium curves (>0.15): gain = 2.2,  lookahead = 1.0m
Straight:              gain = 1.9,  lookahead = 1.1m

# 필터
alpha = 0.70  (중간값)

# 보정 한계
ct_correction = ±0.85 rad/s
```

**예상 결과:**
- **경로 정확한 추종** ✅
- 평균 오차: < 0.2m (목표)
- 최대 오차: < 0.4m (목표)

**이유:**
- Gain **적절** (2.2-2.5)
- Lookahead **적절** (1.0-1.1m)
- → **균형잡힌 제어**

---

## 📊 상세 수치 비교표

### Gain 비교

| 구간 | Phase 1 (이전) | Phase 2 (현재) | Phase 3 (예상) | 변화 |
|------|----------------|----------------|----------------|------|
| Sharp | **3.0** | 2.0 | **2.5** | 이전보다 ⬇️17%, 현재보다 ⬆️25% |
| Medium | **2.6** | 1.8 | **2.2** | 이전보다 ⬇️15%, 현재보다 ⬆️22% |
| Straight | **2.3** | 1.5 | **1.9** | 이전보다 ⬇️17%, 현재보다 ⬆️27% |

### Lookahead 비교

| 구간 | Phase 1 (이전) | Phase 2 (현재) | Phase 3 (예상) | 변화 |
|------|----------------|----------------|----------------|------|
| Sharp | **0.9m** | 0.8m | **1.0m** | 중간값 |
| Medium | **0.9m** | 1.2m | **1.0m** | 중간보다 약간 짧게 |
| Straight | **1.1m** | 1.5m | **1.1m** | 이전과 동일 |

### 기타 파라미터 비교

| 파라미터 | Phase 1 (이전) | Phase 2 (현재) | Phase 3 (예상) |
|----------|----------------|----------------|----------------|
| **v_max** | 0.08 m/s | 0.12 m/s | 0.10 m/s |
| **k_th** | 0.7 | 1.2 | 0.9 |
| **alpha** | 0.65 | 0.75 | 0.70 |
| **ct_limit** | ±0.9 | ±0.8 | ±0.85 |

---

## 🔍 보정력 vs 이탈력 분석

### 시나리오: 로봇이 0.3m 바깥에 위치

#### Phase 1: 이전 (안쪽 이탈)

```python
보정력 = gain × error
       = 3.0 × 0.3
       = 0.9 rad/s  (💪 매우 강함!)

이탈력 (short lookahead 0.9m)
       = 0.3 rad/s  (약함)

결과: 보정력 >> 이탈력
     → 과도한 보정
     → 경로 안쪽(왼쪽)으로 이탈! ⬅️
```

#### Phase 2: 현재 (바깥쪽 이탈)

```python
보정력 = gain × error
       = 2.0 × 0.3
       = 0.6 rad/s  (약함)

이탈력 (long lookahead 1.5m)
       = 0.6 rad/s  (강함)

결과: 보정력 ≈ 이탈력
     → 평형 상태
     → 오프셋 유지/바깥쪽 이탈! ➡️
```

#### Phase 3: 예상 (정확한 추종)

```python
보정력 = gain × error
       = 2.5 × 0.3
       = 0.75 rad/s  (적절함)

이탈력 (medium lookahead 1.0m)
       = 0.4 rad/s  (적절함)

결과: 보정력 > 이탈력
     → 경로로 복귀
     → 정확한 추종! ✅
```

---

## 📈 시각적 비교

### 보정력 vs 이탈력 그래프

```
보정력
  ▲
  │
1.0│  [Phase 1]
  │      🔴 과도한 보정 (안쪽 이탈)
0.9│      ●
  │      
0.8│              [Phase 3]
  │              🟢 균형 (정확한 추종)
0.7│              ●
  │              
0.6│                      [Phase 2]
  │                      🔵 부족한 보정 (바깥쪽 이탈)
0.5│                      ●
  │
  └──────────────────────────────▶ 이탈력
    0.2   0.3   0.4   0.5   0.6
```

### 결과 맵핑

```
경로 안쪽 ←─────── 경로 ───────→ 경로 바깥쪽
          
   [Phase 1]      [Phase 3]     [Phase 2]
   안쪽 이탈      정확 추종     바깥쪽 이탈
   ⬅️ 0.5m        ✅ 경로        ➡️ 0.3m
   
   Gain 3.0      Gain 2.5      Gain 2.0
   Look 0.9m     Look 1.0m     Look 1.5m
```

---

## 💡 핵심 인사이트

### 1. 진자 운동 (Pendulum)

```
Phase 1: 한쪽 극단 (너무 강함)
           ⬅️
Phase 2: 반대 극단 (너무 약함)
                          ➡️
Phase 3: 중심 (균형)
              ✅
```

### 2. 황금 비율 발견

```
이전 (Phase 1):
- Gain: 3.0
- Lookahead: 0.9m
- 결과: 과보정 ❌

현재 (Phase 2):
- Gain: 2.0
- Lookahead: 1.5m
- 결과: 부족 ❌

최적 (Phase 3):
- Gain: 2.5 = (3.0 + 2.0) / 2
- Lookahead: 1.0m ≈ (0.9 + 1.2) / 2
- 결과: 균형! ✅
```

### 3. 중간값이 답!

```
모든 파라미터를 이전과 현재의 중간값으로:

Gain:  3.0 → 2.5 ← 2.0
Look:  0.9 → 1.0 ← 1.5
Speed: 0.08 → 0.10 ← 0.12
k_th:  0.7 → 0.9 ← 1.2
alpha: 0.65 → 0.70 ← 0.75
```

---

## 🎯 요약

### 질문에 대한 답변

**Q: "반대로 이전에는 경로 안쪽을 돌았었을 때 이때의 값은 얼마였는데?"**

**A: 이전 설정값 (안쪽 이탈 시):**

| 파라미터 | 이전 값 | 현재 값 | 예상 최적값 |
|----------|---------|---------|-------------|
| **Sharp Gain** | **3.0** | 2.0 | **2.5** |
| **Medium Gain** | **2.6** | 1.8 | **2.2** |
| **Straight Gain** | **2.3** | 1.5 | **1.9** |
| **Sharp Look** | **0.9m** | 0.8m | **1.0m** |
| **Medium Look** | **0.9m** | 1.2m | **1.0m** |
| **Straight Look** | **1.1m** | 1.5m | **1.1m** |
| **속도** | **0.08** | 0.12 | **0.10** |
| **k_th** | **0.7** | 1.2 | **0.9** |

**패턴:**
- 이전: **너무 강함** → 안쪽 이탈 ⬅️
- 현재: **너무 약함** → 바깥쪽 이탈 ➡️
- 최적: **중간값** → 정확한 추종 ✅

---

## 🔧 결론

**이전 → 현재 → 최적**

```
[안쪽]  ←  [경로]  →  [바깥쪽]
  
Phase 1     Phase 3      Phase 2
(이전)      (최적)       (현재)

Gain 3.0 → Gain 2.5 ← Gain 2.0
Look 0.9 → Look 1.0 ← Look 1.5

과보정 ❌   균형 ✅    부족 ❌
```

**해결책: 중간값 사용!** 🎯
